# 体质推荐食谱系统详解

## 概述

这是一个基于中医体质学说和现代推荐算法的个性化食谱推荐系统，能够根据用户的体质类型、口味偏好、饮食禁忌等因素，智能推荐最适合的健康食谱。

## 系统架构

### 1. 数据模型设计

#### 体质模型 (Constitution)

系统定义了 9 种中医体质类型，每种体质都有详细的特征和饮食指导：

| 体质类型   | 特征                   | 饮食宜忌           | 推荐食材                     |
| ---------- | ---------------------- | ------------------ | ---------------------------- |
| **平和质** | 阴阳气血调和，体态适中 | 饮食均衡，避免过度 | 五谷杂粮、新鲜蔬果、适量肉类 |
| **气虚质** | 元气不足，容易疲劳     | 宜温补，忌生冷     | 黄芪、党参、山药、大枣、鸡肉 |
| **阳虚质** | 阳气不足，畏寒怕冷     | 宜温热，忌寒凉     | 羊肉、韭菜、生姜、桂圆、核桃 |
| **阴虚质** | 阴液亏少，口燥咽干     | 宜清润，忌温燥     | 银耳、百合、枸杞、鸭肉、梨   |
| **痰湿质** | 形体肥胖，容易困倦     | 宜清淡，忌肥甘     | 薏米、冬瓜、山楂、荷叶、陈皮 |
| **湿热质** | 湿热内蕴，容易长痘     | 宜清热，忌辛辣     | 绿豆、苦瓜、黄瓜、薏米、冬瓜 |
| **血瘀质** | 血行不畅，面色晦暗     | 宜活血，忌寒凉     | 山楂、红糖、玫瑰花、黑木耳   |
| **气郁质** | 气机郁滞，情绪抑郁     | 宜疏肝，忌收敛     | 玫瑰花、佛手、陈皮、柑橘     |
| **特禀质** | 先天禀赋不足，易过敏   | 宜清淡，忌发物     | 新鲜蔬果、糙米、适量蛋白质   |

#### 食谱模型 (Recipe)

每个食谱包含以下关键属性：

- **基本信息**: 名称、描述、图片、emoji
- **性味归经**:
  - `nature`: 寒、凉、平、温、热
  - `flavors`: 酸、甘、苦、辛、咸等味道
  - `meridians`: 归经（肺经、脾经、心经等）
- **体质适宜性**:
  - `suitableConstitutions`: 适合的体质列表
  - `avoidConstitutions`: 不适合的体质列表
- **烹饪信息**:
  - `cookingTime`: 烹饪时间（分钟）
  - `difficulty`: 难度（简单、中等、困难）
  - `ingredients`: 食材列表
  - `steps`: 烹饪步骤
- **评分**: `baseScore` 基础匹配分数（0-100，默认 80）

#### 用户模型

- **User**: 用户基础信息和体质类型
- **UserPreference**: 用户偏好设置
  - 五味偏好（0-100 评分）
  - 饮食禁忌和过敏原
  - 当前身体状态
  - 用餐场景偏好
  - 烹饪难度和时间偏好

### 2. 推荐算法核心

#### 匹配度计算算法

系统使用多维度评分算法为每个食谱计算匹配度分数：

```javascript
// 基础分数
let score = recipe.baseScore || 80;

// 1. 体质匹配（权重最高）
if (constitution) {
	// 适宜体质加分
	if (recipe.suitableConstitutions?.includes(constitution)) {
		score += 10; // 适合您的体质
	}

	// 不适宜体质减分
	if (recipe.avoidConstitutions?.includes(constitution)) {
		score -= 20; // 不太适合您的体质
	}

	// 根据体质和食物性味进行精细调整
	score += calculateNatureScore(recipe.nature, constitution);
}
```

#### 体质与性味匹配规则

| 体质类型 | 适宜性味 | 加分 | 禁忌性味 | 减分 |
| -------- | -------- | ---- | -------- | ---- |
| 阳虚质   | 温、热   | +5   | 凉、寒   | -10  |
| 阴虚质   | 凉、平   | +5   | 热       | -10  |
| 湿热质   | 凉、寒   | +5   | 热       | -10  |
| 痰湿质   | 温       | +3   | 寒       | -5   |
| 气虚质   | 温、平   | +5   | 寒       | -5   |
| 血瘀质   | 温       | +3   | -        | 0    |

#### 口味偏好匹配

```javascript
// 五味偏好评分 (0-100)
const flavorMap = {
	酸: "sour",
	甘: "sweet",
	苦: "bitter",
	辛: "spicy",
	咸: "salty"
};

if (userFlavorPreference >= 70) {
	score += 3; // 用户喜欢这个口味
} else if (userFlavorPreference <= 30) {
	score -= 5; // 用户不喜欢这个口味
}
```

#### 禁忌食材检查

```javascript
// 检查是否含有禁忌食材
const exclusionKeywords = {
	seafood: ["海鲜", "虾", "蟹", "鱼", "贝"],
	cilantro: ["香菜", "芫荽"],
	spicy: ["辣椒", "辣", "花椒", "胡椒"]
	// ... 更多禁忌分类
};

if (hasExcluded) {
	score -= 30; // 含有您忌口的食材
}
```

#### 当前状态调整

根据用户当前身体状况动态调整推荐：

- **生理期**: 适宜温补 (+5 分)，避免寒凉 (-10 分)
- **熬夜后**: 适宜滋阴清热 (+3 分)
- **感冒期间**: 适宜温和易消化 (+3 分)
- **运动后**: 适宜高蛋白 (+5 分)
- **宿醉后**: 适宜清淡养胃 (+3 分)

#### 烹饪偏好

- **时间偏好**: 符合用户时间要求 +3 分，超时太多 -5 分
- **难度偏好**: 符合用户难度偏好 +2 分，难度过高 -3 分

#### 用餐场景

- **宵夜**: 清淡易消化 +3 分
- **约会**: 精致美观 +4 分
- **家庭聚餐**: 家常菜 +3 分
- **上班族**: 快手菜 +3 分
- **养生**: 滋补调理 +5 分

### 3. API 接口实现

#### 主要推荐接口

##### 1. 获取食谱列表（自动计算匹配度）

```
GET /api/recipes
```

**请求头**: `X-Session-Id: 用户会话ID`

**响应示例**:

```json
{
	"code": 0,
	"data": {
		"list": [
			{
				"_id": "recipe_id",
				"name": "红枣山药粥",
				"description": "温补脾胃，适合气虚体质",
				"nature": "温",
				"matchScore": 95,
				"matchReason": "温补之品，适合气虚体质"
			}
		],
		"pagination": {
			"page": 1,
			"pageSize": 10,
			"total": 50
		}
	}
}
```

##### 2. 个性化推荐

```
GET /api/recipes/recommend?limit=6
```

##### 3. AI 智能推荐

```
POST /api/recipes/ai-recommend
```

#### 工作流程

1. **用户认证**: 通过 `X-Session-Id` 识别用户
2. **数据获取**: 查询用户体质和偏好信息
3. **匹配计算**: 调用 `rankRecipes()` 算法计算匹配度
4. **排序返回**: 按匹配度降序返回推荐结果

### 4. AI 增强功能

#### AI 生成食谱

根据用户描述和体质自动生成个性化食谱：

```javascript
// AI生成个性化食谱
const generateRecipeByAI = async (
	dishDescription,
	targetConstitution,
	specialRequirements
) => {
	// 使用GPT等大语言模型生成食谱
	// 包含体质适配、性味分析、食材搭配等
};
```

#### AI 智能推荐

深度分析用户偏好，提供营养均衡的推荐：

```javascript
const getAIRecommendations = async (userProfile, constitution, mealType) => {
	// AI分析用户画像
	// 生成个性化推荐策略
	// 提供营养平衡建议
};
```

### 5. 中医理论依据

#### 核心原理

1. **寒热平衡**: "寒者热之，热者寒之"

   - 寒性体质用温性食物调理
   - 热性体质用凉性食物平衡

2. **五味调和**: "五味入五脏"

   - 酸味入肝，苦味入心，甘味入脾，辛味入肺，咸味入肾
   - 根据体质调整五味比例

3. **归经理论**: 食物对特定脏腑的调理作用

   - 不同食材归经不同，调理效果各异

4. **因时制宜**: 考虑季节和时令
   - 春季养肝，夏季养心，长夏养脾，秋季养肺，冬季养肾

#### 体质辨识方法

- **问卷调查**: 通过症状问卷判断体质类型
- **AI 辅助**: 使用机器学习算法辅助体质辨识
- **专业诊断**: 结合中医专家经验

### 6. 实际应用示例

#### 示例 1：阳虚体质用户推荐

**用户信息**:

- 体质: 阳虚质
- 偏好: 喜欢甜味，忌海鲜
- 当前状态: 冬季

**推荐结果**:

1. **羊肉生姜汤** (匹配度: 95 分)

   - 性温，适合阳虚体质
   - 生姜温阳散寒
   - 匹配理由: "温补之品，适合阳虚体质"

2. **桂圆红枣茶** (匹配度: 88 分)

   - 性温，味甘
   - 温补心脾
   - 符合用户甜味偏好

3. **绿豆汤** (匹配度: 45 分)
   - 性凉，不适合阳虚体质
   - 含有用户忌口的豆类（绿豆）

#### 示例 2：湿热体质用户推荐

**用户信息**:

- 体质: 湿热质
- 当前状态: 夏季，容易长痘

**推荐结果**:

1. **冬瓜薏米汤** (匹配度: 92 分)

   - 清热利湿
   - 薏米健脾祛湿
   - 适合夏季调理

2. **苦瓜炒蛋** (匹配度: 85 分)
   - 苦味清心火
   - 清热解毒，适合长痘调理

### 7. 技术实现亮点

#### 1. 多维度评分系统

- 综合考虑体质、口味、禁忌、状态等多个因素
- 动态权重调整，适应不同场景需求

#### 2. 中医理论与现代算法结合

- 基于传统中医体质学说
- 使用现代推荐算法优化用户体验

#### 3. AI 增强推荐

- 集成大语言模型生成个性化食谱
- 智能分析用户偏好变化

#### 4. 可扩展架构

- 模块化设计，易于添加新的推荐维度
- 支持多语言、多文化适配

### 8. 系统优势

1. **科学性**: 基于中医经典理论，数千年的实践验证
2. **个性化**: 多维度综合分析，精准匹配个人需求
3. **智能化**: AI 技术增强推荐效果
4. **实用性**: 考虑用户实际烹饪条件和偏好
5. **可扩展**: 架构灵活，支持功能持续迭代

### 9. 未来发展方向

1. **营养成分分析**: 添加详细的营养成分数据库
2. **季节智能推荐**: 根据节气变化调整推荐策略
3. **社交功能**: 用户分享食谱和调理心得
4. **健康监测**: 集成可穿戴设备数据
5. **多模态交互**: 支持语音、图像等多种交互方式

## 总结

这个体质推荐食谱系统成功地将传统中医理论与现代技术相结合，通过多维度的智能推荐算法，为用户提供个性化的健康饮食方案。系统不仅考虑了体质类型这一核心因素，还综合了用户的口味偏好、饮食禁忌、当前身体状态、烹饪习惯等多个维度，真正实现了"因人而异"的精准营养指导。

通过科学的算法设计和中医理论的指导，该系统能够为不同体质的用户提供最适合的食谱推荐，帮助用户通过合理的饮食调理改善体质，促进健康。
